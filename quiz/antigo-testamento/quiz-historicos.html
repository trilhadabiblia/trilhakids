<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz Flashcard - Livros HistÃ³ricos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card-flip {
      transform-style: preserve-3d;
      transition: transform 0.6s;
    }
    .card-flip.flipped {
      transform: rotateY(180deg);
    }
    .card-front, .card-back {
      backface-visibility: hidden;
    }
    .card-back {
      transform: rotateY(180deg);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen font-sans text-gray-100">

  <!-- Header -->
  <header class="bg-gradient-to-r from-violet-600 to-purple-600 backdrop-blur-xl border-b border-purple-400/30 sticky top-0 z-20 shadow-2xl">
    <div class="max-w-7xl mx-auto px-4 py-6">
      <div class="text-center">
        <h1 class="text-4xl font-black text-white drop-shadow-lg mb-2">ğŸ¯ QUIZ FLASHCARD BÃBLICO</h1>
        <p class="text-purple-100">Teste seus conhecimentos sobre os Livros HistÃ³ricos!</p>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-5xl mx-auto px-4 py-12">
    
    <!-- Seletor de Livros -->
    <div id="lista-livros" class="grid md:grid-cols-2 lg:grid-cols-6 gap-3 mb-12 w-full max-w-6xl mx-auto">
      <!-- Os livros serÃ£o carregados dinamicamente do JSON -->
    </div>

    <!-- Ãrea do Flashcard -->
    <div class="mb-12">
      <div class="text-center mb-6">
        <h2 class="text-3xl font-black text-white" id="titulo-livro">Selecione um livro para comeÃ§ar!</h2>
        <p class="text-gray-300 mt-2" id="progresso">Carta 0 de 0</p>
      </div>

      <!-- Card FlipÃ¡vel -->
      <div class="mb-8 flex justify-center" style="perspective: 1000px;">
        <div class="card-flip w-full max-w-2xl h-96 cursor-pointer relative" id="card" onclick="virarCarta()" style="transform-style: preserve-3d;">
          <!-- Frente -->
          <div class="card-front absolute w-full h-full bg-gradient-to-br from-blue-500 to-cyan-500 rounded-2xl shadow-2xl p-8 flex flex-col justify-center items-center text-center border-4 border-white/20" style="backface-visibility: hidden;">
            <div class="text-6xl mb-6">â“</div>
            <p class="text-white text-2xl font-bold" id="pergunta">Selecione um livro para comeÃ§ar</p>
            <p class="text-blue-100 text-sm mt-6">Clique para ver as opÃ§Ãµes</p>
          </div>
          <!-- Verso -->
          <div class="card-back absolute w-full h-full bg-gradient-to-br from-yellow-500 to-amber-500 rounded-2xl shadow-2xl p-8 flex flex-col justify-center items-center text-center border-4 border-white/20" style="backface-visibility: hidden; transform: rotateY(180deg);">
            <div class="text-4xl mb-4">âœ…</div>
            <p class="text-white text-lg font-bold mb-6">Escolha a resposta:</p>
            <div id="opcoes-resposta" class="w-full space-y-3">
              <!-- OpÃ§Ãµes serÃ£o inseridas aqui -->
            </div>
          </div>
        </div>
      </div>

      <!-- Controles de NavegaÃ§Ã£o -->
      <div class="flex justify-center gap-4 mb-8">
        <button onclick="cartaAnterior()" class="bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white px-8 py-3 rounded-lg font-bold transition-all" id="btn-anterior" disabled>
          â¬…ï¸ Anterior
        </button>
        <button onclick="cartaProxima()" class="bg-gradient-to-r from-purple-600 to-violet-600 hover:from-purple-700 hover:to-violet-700 text-white px-8 py-3 rounded-lg font-bold transition-all" id="btn-proxima">
          PrÃ³xima â¡ï¸
        </button>
      </div>

      <!-- Indicador de Progresso -->
      <div class="w-full bg-gray-700 rounded-full h-3 overflow-hidden">
        <div class="bg-gradient-to-r from-purple-600 to-violet-600 h-full transition-all duration-500" id="barra-progresso" style="width: 0%"></div>
      </div>
    </div>

    <!-- Stats -->
    <div class="grid md:grid-cols-3 gap-6 bg-gradient-to-br from-purple-500/10 to-violet-500/10 border border-purple-500/30 rounded-2xl p-8">
      <div class="text-center">
        <div class="text-5xl font-black text-purple-300 mb-2" id="total-cartas">0</div>
        <p class="text-gray-300">Total de Cartas</p>
      </div>
      <div class="text-center">
        <div class="text-5xl font-black text-blue-300 mb-2" id="cartas-feitas">0</div>
        <p class="text-gray-300">Cartas Estudadas</p>
      </div>
      <div class="text-center">
        <div class="text-5xl font-black text-green-300 mb-2" id="percentual">0%</div>
        <p class="text-gray-300">Progresso</p>
      </div>
    </div>

  </main>

  <!-- Footer -->
  <footer class="bg-gradient-to-r from-slate-800 to-slate-900 border-t border-purple-500/30 p-6 text-center text-gray-400 mt-12">
    <p class="font-semibold mb-2">Â© 2025 - Trilha HistÃ³rica da BÃ­blia</p>
    <p class="text-sm">MinistÃ©rio Infantil - Kids | Quiz Flashcard ğŸ¯</p>
  </footer>

  <script src="../../gamificacao.js"></script>
  <script>
    let dadosQuiz = null;
    let livroAtual = null;
    let cartaAtual = 0;
    let cartaVirada = false;
    let acertos = 0;
    let cartasRespondidas = new Set();

    const icones = {
      "JosuÃ©": "ğŸ“˜",
      "JuÃ­zes": "âš–ï¸",
      "Rute": "ğŸŒ¾",
      "1 Samuel": "ğŸ‘‘",
      "2 Samuel": "ğŸ“•",
      "1 Reis": "ğŸ‘¨â€ğŸ‘¸",
      "2 Reis": "ğŸ°",
      "1 CrÃ´nicas": "ğŸ“œ",
      "2 CrÃ´nicas": "ğŸ“–",
      "Esdras": "ğŸ”¨",
      "Neemias": "ğŸ§±",
      "Ester": "ğŸ‘¸"
    };

    const cores = {
      "JosuÃ©": "from-cyan-600 to-blue-600",
      "JuÃ­zes": "from-purple-600 to-red-600",
      "Rute": "from-amber-600 to-yellow-600",
      "1 Samuel": "from-red-600 to-rose-600",
      "2 Samuel": "from-rose-600 to-pink-600",
      "1 Reis": "from-orange-600 to-amber-600",
      "2 Reis": "from-amber-600 to-yellow-600",
      "1 CrÃ´nicas": "from-teal-600 to-cyan-600",
      "2 CrÃ´nicas": "from-cyan-600 to-blue-600",
      "Esdras": "from-green-600 to-emerald-600",
      "Neemias": "from-emerald-600 to-teal-600",
      "Ester": "from-indigo-600 to-purple-600"
    };

    // Carregar JSON
    async function carregarQuiz() {
      try {
        const response = await fetch('./quiz-historicos.json');
        dadosQuiz = await response.json();
        renderizarLivros();
      } catch (error) {
        console.error('Erro ao carregar quiz-historicos.json:', error);
        alert('Erro ao carregar o quiz. Verifique se o arquivo quiz-historicos.json estÃ¡ na mesma pasta.');
      }
    }

    function renderizarLivros() {
      const container = document.getElementById('lista-livros');
      container.innerHTML = '';
      
      dadosQuiz.livros.forEach(livro => {
        const div = document.createElement('div');
        div.className = 'group cursor-pointer';
        div.onclick = () => selecionarLivro(livro.nome);
        
        const cor = cores[livro.nome] || 'from-gray-600 to-gray-700';
        const icone = icones[livro.nome] || 'ğŸ“š';
        
        div.innerHTML = `
          <div class="bg-gradient-to-br ${cor} rounded-xl p-4 text-center hover:shadow-lg hover:shadow-blue-500/30 transition-all duration-300 hover:scale-105 border-4 border-transparent" id="btn-${livro.nome.replace(/\s+/g, '-')}">
            <div class="text-3xl mb-2">${icone}</div>
            <h3 class="font-bold text-white text-sm">${livro.nome}</h3>
          </div>
        `;
        container.appendChild(div);
      });
    }

    function selecionarLivro(nomeLivro) {
      const livro = dadosQuiz.livros.find(l => l.nome === nomeLivro);
      if (!livro) return;

      livroAtual = livro;
      cartaAtual = 0;
      cartaVirada = false;
      acertos = 0;
      cartasRespondidas = new Set();
      
      // Remove seleÃ§Ã£o anterior
      document.querySelectorAll('[id^="btn-"]').forEach(btn => {
        btn.classList.remove('border-yellow-400');
        btn.classList.add('border-transparent');
      });
      
      // Adiciona seleÃ§Ã£o atual
      const btnId = `btn-${nomeLivro.replace(/\s+/g, '-')}`;
      const btn = document.getElementById(btnId);
      if (btn) {
        btn.classList.remove('border-transparent');
        btn.classList.add('border-yellow-400');
      }
      
      atualizarCarta();
    }

    function atualizarCarta() {
      if (!livroAtual) return;

      const perguntas = livroAtual.perguntas;
      const perguntaAtual = perguntas[cartaAtual];

      document.getElementById('titulo-livro').textContent = `${icones[livroAtual.nome] || 'ğŸ“š'} Livro de ${livroAtual.nome}`;
      document.getElementById('pergunta').textContent = perguntaAtual.pergunta;
      document.getElementById('progresso').textContent = `Carta ${cartaAtual + 1} de ${perguntas.length}`;
      
      // Atualizar opÃ§Ãµes de resposta
      const opcoesContainer = document.getElementById('opcoes-resposta');
      opcoesContainer.innerHTML = '';
      
      perguntaAtual.opcoes.forEach((opcao, index) => {
        const btn = document.createElement('button');
        btn.className = 'w-full bg-white/20 hover:bg-white/30 text-white px-4 py-3 rounded-lg font-semibold transition-all hover:scale-105';
        btn.textContent = opcao;
        btn.onclick = (e) => {
          e.stopPropagation();
          verificarResposta(index);
        };
        opcoesContainer.appendChild(btn);
      });
      
      // Atualizar barra de progresso
      const percentual = ((cartaAtual + 1) / perguntas.length) * 100;
      document.getElementById('barra-progresso').style.width = percentual + '%';
      document.getElementById('total-cartas').textContent = perguntas.length;
      document.getElementById('cartas-feitas').textContent = cartaAtual + 1;
      document.getElementById('percentual').textContent = Math.round(percentual) + '%';

      // Resetar card
      document.getElementById('card').classList.remove('flipped');
      cartaVirada = false;

      // Habilitar/desabilitar botÃµes
      document.getElementById('btn-anterior').disabled = cartaAtual === 0;
      document.getElementById('btn-proxima').disabled = cartaAtual === perguntas.length - 1;

      // Atualizar cor do card
      const card = document.getElementById('card');
      const corClass = cores[livroAtual.nome] || 'from-gray-600 to-gray-700';
      card.querySelector('.card-front').className = `card-front absolute w-full h-full bg-gradient-to-br ${corClass} rounded-2xl shadow-2xl p-8 flex flex-col justify-center items-center text-center border-4 border-white/20`;
    }

    function verificarResposta(indiceEscolhido) {
      if (cartasRespondidas.has(cartaAtual)) return;
      
      const perguntaAtual = livroAtual.perguntas[cartaAtual];
      const acertou = indiceEscolhido === perguntaAtual.correta;
      
      // Feedback visual
      const opcoesContainer = document.getElementById('opcoes-resposta');
      const botoes = opcoesContainer.querySelectorAll('button');
      
      botoes.forEach((btn, index) => {
        btn.disabled = true;
        if (index === perguntaAtual.correta) {
          btn.className = 'w-full bg-green-500 text-white px-4 py-3 rounded-lg font-semibold';
        } else if (index === indiceEscolhido && !acertou) {
          btn.className = 'w-full bg-red-500 text-white px-4 py-3 rounded-lg font-semibold';
        }
      });
      registroDeResposta(acertou);
    }

    function virarCarta() {
      if (cartasRespondidas.has(cartaAtual)) return; // NÃ£o vira se jÃ¡ respondeu
      
      const card = document.getElementById('card');
      card.classList.toggle('flipped');
      cartaVirada = !cartaVirada;
    }

    function registroDeResposta(acertou) {
      if (cartasRespondidas.has(cartaAtual)) return;
      
      cartasRespondidas.add(cartaAtual);
      if (acertou) acertos++;
      
      // Se respondeu todas as cartas do livro
      const perguntas = livroAtual.perguntas;
      if (cartasRespondidas.size === perguntas.length) {
        finalizarQuiz();
      } else {
        // AvanÃ§ar para prÃ³xima carta automaticamente
        setTimeout(() => {
          if (cartaAtual < perguntas.length - 1) {
            cartaProxima();
          }
        }, 1500);
      }
    }

    function finalizarQuiz() {
      const perguntas = livroAtual.perguntas;
      const total = perguntas.length;
      
      // Registrar no sistema de gamificaÃ§Ã£o
      if (typeof trilhoGame !== 'undefined') {
        trilhoGame.completarQuiz(`Quiz ${livroAtual.nome}`, acertos, total);
      }
      trilhoGame.completarQuiz(`Quiz ${livroAtual.nome}`, acertos, total);
      
      // Mostrar resultado final
      setTimeout(() => {
        const percentual = Math.round((acertos / total) * 100);
        let mensagem = '';
        let emoji = '';
        
        if (percentual === 100) {
          mensagem = 'PERFEITO! VocÃª dominou este livro! ğŸ†';
          emoji = 'ğŸ‰';
        } else if (percentual >= 75) {
          mensagem = 'Muito bem! Continue assim! ğŸ‘';
          emoji = 'ğŸ˜Š';
        } else if (percentual >= 50) {
          mensagem = 'Bom trabalho! Pode melhorar! ğŸ’ª';
          emoji = 'ğŸ™‚';
        } else {
          mensagem = 'Continue estudando! VocÃª consegue! ğŸ“š';
          emoji = 'ğŸ˜…';
        }
        
        alert(`${emoji}\n\n${mensagem}\n\nAcertos: ${acertos}/${total} (${percentual}%)\n\nSeus pontos foram registrados!`);
        
        // Reset para refazer o quiz
        acertos = 0;
        cartasRespondidas = new Set();
        cartaAtual = 0;
        atualizarCarta();
      }, 1000);
    }

    function cartaProxima() {
      if (!livroAtual) return;
      
      if (cartaAtual < livroAtual.perguntas.length - 1) {
        cartaAtual++;
        atualizarCarta();
      }
    }

    function cartaAnterior() {
      if (!livroAtual) return;
      
      if (cartaAtual > 0) {
        cartaAtual--;
        atualizarCarta();
      }
    }

    // Teclado
    document.addEventListener('keydown', (e) => {
      if (!livroAtual) return;
      if (e.key === 'ArrowRight') cartaProxima();
      if (e.key === 'ArrowLeft') cartaAnterior();
      if (e.key === ' ') {
        e.preventDefault();
        virarCarta();
      }
    });

    // Carregar quiz ao iniciar
    carregarQuiz();
  </script>
  <script src="/menu.js"></script>
</body>
</html>