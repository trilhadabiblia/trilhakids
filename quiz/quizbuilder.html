<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Quiz - Trilho Kids</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .loading {
            animation: pulse 1.5s ease-in-out infinite;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen p-6">

    <div class="max-w-6xl mx-auto">

        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-black text-white mb-3">üìñ Gerador de Quiz B√≠blico</h1>
            <p class="text-purple-200 text-lg">Trilho Kids - Sistema Inteligente</p>
        </div>

        <!-- Form -->
        <div class="bg-white/10 backdrop-blur-lg border border-purple-500/30 rounded-3xl p-8 mb-8">
            <div class="space-y-6">
                <div>
                    <label class="block text-white font-bold mb-2">Nome do Livro B√≠blico</label>
                    <input type="text" id="livro-input" placeholder="Ex: G√™nesis, √äxodo, Mateus..."
                        class="w-full p-4 rounded-xl bg-white text-gray-800 font-semibold text-lg" />
                </div>

                <div>
                    <label class="block text-white font-bold mb-2">Contexto do Livro</label>
                    <textarea id="contexto-input"
                        placeholder="Cole aqui o conte√∫do/contexto do livro que est√° no portal (hist√≥ria, personagens principais, li√ß√µes-chave, vers√≠culos importantes...)"
                        rows="10"
                        class="w-full p-4 rounded-xl bg-white text-gray-800 font-semibold resize-none"></textarea>
                </div>

                <button id="gerar-btn" onclick="gerarQuestoes()"
                    class="w-full bg-gradient-to-r from-green-500 to-emerald-500 text-white text-xl font-bold py-4 px-8 rounded-full hover:scale-105 transition-all duration-300">
                    üöÄ Gerar Quiz
                </button>

                <div id="loading" class="hidden text-center">
                    <div class="text-white text-xl font-bold loading">‚è≥ Gerando quest√µes incr√≠veis...</div>
                    <p class="text-purple-300 mt-2">Isso pode levar de 10-20 segundos</p>
                </div>
            </div>
        </div>

        <!-- Results -->
        <div id="results" class="hidden space-y-6">

            <!-- Action Buttons -->
            <div class="flex flex-wrap gap-4 justify-center">
                <button onclick="downloadJSON()"
                    class="flex items-center gap-2 bg-blue-600 text-white font-bold py-3 px-6 rounded-full hover:bg-blue-700 transition">
                    üìÑ Baixar JSON
                </button>

                <button onclick="downloadHTML()"
                    class="flex items-center gap-2 bg-purple-600 text-white font-bold py-3 px-6 rounded-full hover:bg-purple-700 transition">
                    üì• Baixar HTML
                </button>

                <button onclick="toggleView()"
                    class="flex items-center gap-2 bg-gray-700 text-white font-bold py-3 px-6 rounded-full hover:bg-gray-800 transition">
                    <span id="toggle-icon">üëÅÔ∏è</span> <span id="toggle-text">Ver HTML</span>
                </button>

                <button onclick="resetForm()"
                    class="flex items-center gap-2 bg-red-600 text-white font-bold py-3 px-6 rounded-full hover:bg-red-700 transition">
                    üîÑ Nova Gera√ß√£o
                </button>
            </div>

            <!-- Preview -->
            <div class="bg-white/10 backdrop-blur-lg border border-purple-500/30 rounded-3xl p-8">

                <!-- Quest√µes Preview -->
                <div id="questoes-preview">
                    <h3 class="text-2xl font-bold text-white mb-6">‚úÖ Quest√µes Geradas (<span
                            id="total-questoes">0</span>)</h3>
                    <div id="questoes-list" class="space-y-6">
                        <!-- Quest√µes ser√£o inseridas aqui -->
                    </div>
                </div>

                <!-- HTML Preview -->
                <div id="html-preview" class="hidden">
                    <h3 class="text-2xl font-bold text-white mb-4">üìÑ C√≥digo HTML</h3>
                    <pre id="html-code" class="bg-gray-900 text-green-400 p-6 rounded-xl overflow-x-auto text-sm"></pre>
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="mt-12 bg-gradient-to-r from-blue-500/10 to-purple-500/10 border border-blue-500/30 rounded-2xl p-8">
            <h3 class="text-2xl font-bold text-white mb-4">üìã Como Usar</h3>
            <ol class="text-gray-200 space-y-3 list-decimal list-inside">
                <li>Digite o nome do livro b√≠blico (ex: G√™nesis, Mateus)</li>
                <li>Cole o contexto/conte√∫do do livro que est√° no portal</li>
                <li>Clique em "Gerar Quiz" e aguarde (leva ~10-20 segundos)</li>
                <li>Revise as quest√µes geradas</li>
                <li>Baixe o JSON (para backup) e o HTML (para usar no site)</li>
                <li>Coloque o arquivo HTML na pasta: <code
                        class="bg-gray-800 px-2 py-1 rounded text-yellow-300">quiz/[antigo-testamento ou novo-testamento]/quiz-[nome-do-livro].html</code>
                </li>
            </ol>
        </div>

    </div>

    <script>
        let questoesData = null;
        let livroAtual = '';

        async function gerarQuestoes() {
            const livro = document.getElementById('livro-input').value.trim();
            const contexto = document.getElementById('contexto-input').value.trim();

            if (!livro || !contexto) {
                alert('‚ö†Ô∏è Por favor, preencha o livro e o contexto!');
                return;
            }

            livroAtual = livro;

            // UI Loading
            document.getElementById('gerar-btn').disabled = true;
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');

            try {
                const response = await fetch("http://localhost:3001/api/quiz", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ livro, contexto }),
                });

                const data = await response.json();
                const content = data.content.find(item => item.type === "text")?.text || "";

                // Remove poss√≠veis marcadores de c√≥digo
                const cleanContent = content.replace(/```json\n?|\n?```/g, '').trim();

                questoesData = JSON.parse(cleanContent);

                // Mostrar resultados
                mostrarQuestoes();
                document.getElementById('results').classList.remove('hidden');

            } catch (error) {
                alert('‚ùå Erro ao gerar quest√µes: ' + error.message);
                console.error(error);
            } finally {
                document.getElementById('gerar-btn').disabled = false;
                document.getElementById('loading').classList.add('hidden');
            }
        }

        function mostrarQuestoes() {
            const lista = document.getElementById('questoes-list');
            lista.innerHTML = '';

            document.getElementById('total-questoes').textContent = questoesData.questoes.length;

            questoesData.questoes.forEach((q, idx) => {
                const div = document.createElement('div');
                div.className = 'bg-white/5 border border-purple-400/30 rounded-2xl p-6';

                let opcoesHtml = q.opcoes.map((opcao, optIdx) => {
                    const isCorreta = optIdx === q.correta;
                    return `
            <div class="${isCorreta ? 'bg-green-500/20 border-2 border-green-500 text-green-200 font-bold' : 'bg-gray-800/50 text-gray-300'} p-3 rounded-lg">
              ${String.fromCharCode(65 + optIdx)}) ${opcao}
              ${isCorreta ? ' ‚úì' : ''}
            </div>
          `;
                }).join('');

                div.innerHTML = `
          <h4 class="text-xl font-bold text-purple-300 mb-3">
            ${idx + 1}. ${q.pergunta}
          </h4>
          
          <div class="space-y-2 mb-4">
            ${opcoesHtml}
          </div>
          
          <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-4">
            <p class="text-blue-200 text-sm">
              <strong>Justificativa:</strong> ${q.justificativa}
            </p>
          </div>
        `;

                lista.appendChild(div);
            });
        }

        function gerarHTMLCompleto() {
            return `<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz - ${livroAtual}</title>
  <script src="https://cdn.tailwindcss.com"><\/script>
  <style>
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    .float-animation {
      animation: float 3s ease-in-out infinite;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen font-sans text-gray-100">

  <!-- Header -->
  <header class="bg-gradient-to-r from-violet-600 to-purple-600 backdrop-blur-xl border-b border-purple-400/30 sticky top-0 z-20 shadow-2xl">
    <div class="max-w-7xl mx-auto px-4 py-6">
      <div class="text-center">
        <h1 class="text-3xl md:text-5xl font-black text-white drop-shadow-lg mb-3 float-animation">üìñ QUIZ - ${livroAtual.toUpperCase()}</h1>
        <p class="text-purple-100 text-lg">Teste seus conhecimentos sobre este livro da B√≠blia!</p>
      </div>
    </div>
  </header>

  <!-- Quiz Container -->
  <main class="max-w-4xl mx-auto px-4 py-12">
    
    <!-- Tela Inicial -->
    <div id="start-screen" class="text-center">
      <div class="bg-gradient-to-br from-purple-500/20 to-violet-500/20 border border-purple-500/30 rounded-3xl p-8 md:p-12 mb-8">
        <div class="text-6xl md:text-8xl mb-6">üéØ</div>
        <h2 class="text-3xl md:text-4xl font-black text-white mb-4">Pronto para o Desafio?</h2>
        <p class="text-lg md:text-xl text-gray-300 mb-8">10 perguntas sobre ${livroAtual} te esperam!</p>
        
        <button onclick="startQuiz()" class="bg-gradient-to-r from-green-500 to-emerald-500 text-white text-lg md:text-xl font-bold py-4 px-12 rounded-full hover:scale-105 transition-all duration-300 shadow-2xl hover:shadow-green-500/50">
          Come√ßar Quiz üöÄ
        </button>
      </div>

      <div class="grid md:grid-cols-3 gap-6 text-center">
        <div class="bg-blue-500/10 border border-blue-500/30 rounded-2xl p-6">
          <div class="text-4xl mb-2">‚ùì</div>
          <div class="text-3xl font-bold text-blue-300 mb-2">10</div>
          <p class="text-gray-300">Perguntas</p>
        </div>
        <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-2xl p-6">
          <div class="text-4xl mb-2">‚≠ê</div>
          <div class="text-3xl font-bold text-yellow-300 mb-2">10</div>
          <p class="text-gray-300">Pontos cada</p>
        </div>
        <div class="bg-purple-500/10 border border-purple-500/30 rounded-2xl p-6">
          <div class="text-4xl mb-2">üèÜ</div>
          <div class="text-3xl font-bold text-purple-300 mb-2">100</div>
          <p class="text-gray-300">Pontos m√°ximos</p>
        </div>
      </div>
    </div>

    <!-- Tela do Quiz -->
    <div id="quiz-screen" class="hidden">
      <!-- Progress Bar -->
      <div class="mb-8">
        <div class="flex justify-between items-center mb-3">
          <span class="text-white font-bold text-sm md:text-base">Quest√£o <span id="current-question">1</span> de 10</span>
          <span class="text-yellow-300 font-bold text-lg md:text-xl"><span id="score">0</span> pts</span>
        </div>
        <div class="bg-white/20 rounded-full h-4 overflow-hidden">
          <div id="progress-bar" class="bg-gradient-to-r from-purple-500 to-pink-500 h-full transition-all duration-300" style="width: 10%"></div>
        </div>
      </div>

      <!-- Pergunta -->
      <div class="bg-white rounded-3xl shadow-2xl p-6 md:p-8 mb-6">
        <h3 id="question-text" class="text-xl md:text-3xl font-bold text-gray-800 mb-6 md:mb-8"></h3>

        <div id="options-container" class="space-y-3 md:space-y-4">
          <!-- Op√ß√µes ser√£o inseridas aqui -->
        </div>
      </div>

      <!-- Feedback -->
      <div id="feedback" class="hidden bg-gradient-to-br from-green-500/20 to-emerald-500/20 border border-green-500/30 rounded-3xl p-6 md:p-8">
        <div class="flex items-start gap-4 mb-6">
          <div id="feedback-icon" class="text-4xl md:text-6xl"></div>
          <div class="flex-1">
            <h4 id="feedback-title" class="text-xl md:text-2xl font-bold text-white mb-3"></h4>
            <p id="feedback-text" class="text-gray-200 text-base md:text-lg"></p>
          </div>
        </div>
        <button onclick="nextQuestion()" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white text-lg md:text-xl font-bold py-3 md:py-4 rounded-full hover:scale-105 transition-all duration-300">
          Pr√≥xima Pergunta ‚Üí
        </button>
      </div>
    </div>

    <!-- Tela de Resultado -->
    <div id="result-screen" class="hidden text-center">
      <div class="bg-gradient-to-br from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-3xl p-8 md:p-12">
        <div id="result-emoji" class="text-7xl md:text-9xl mb-6">üéâ</div>
        <h2 class="text-3xl md:text-5xl font-black text-white mb-4">Quiz Conclu√≠do!</h2>
        
        <div class="bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-2xl p-6 md:p-8 mb-8 inline-block">
          <div class="text-5xl md:text-7xl font-black mb-2"><span id="final-score">0</span></div>
          <div class="text-lg md:text-xl opacity-90">de 100 pontos</div>
        </div>

        <p id="result-message" class="text-xl md:text-2xl text-gray-200 mb-8"></p>

        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <button onclick="restartQuiz()" class="bg-gradient-to-r from-green-500 to-emerald-500 text-white text-lg md:text-xl font-bold py-3 md:py-4 px-8 rounded-full hover:scale-105 transition-all duration-300">
            üîÑ Tentar Novamente
          </button>
          <button onclick="window.history.back()" class="bg-gradient-to-r from-gray-600 to-gray-700 text-white text-lg md:text-xl font-bold py-3 md:py-4 px-8 rounded-full hover:scale-105 transition-all duration-300">
            ‚Üê Voltar
          </button>
        </div>
      </div>
    </div>

  </main>

  <!-- Footer -->
  <footer class="bg-gradient-to-r from-slate-800 to-slate-900 border-t border-purple-500/30 p-6 text-center text-gray-400 mt-12">
    <p class="font-semibold mb-2">¬© 2025 - Trilho Kids</p>
    <p class="text-sm">Desenvolvido com ‚ù§Ô∏è para crian√ßas</p>
  </footer>

  <script>
    // Dados do Quiz
    const quizData = ${JSON.stringify(questoesData, null, 2)};

    let currentQuestion = 0;
    let score = 0;
    let answered = false;

    function startQuiz() {
      document.getElementById('start-screen').classList.add('hidden');
      document.getElementById('quiz-screen').classList.remove('hidden');
      loadQuestion();
    }

    function loadQuestion() {
      answered = false;
      const q = quizData.questoes[currentQuestion];
      
      document.getElementById('current-question').textContent = currentQuestion + 1;
      document.getElementById('question-text').textContent = q.pergunta;
      document.getElementById('progress-bar').style.width = ((currentQuestion + 1) / 10 * 100) + '%';
      
      const optionsContainer = document.getElementById('options-container');
      optionsContainer.innerHTML = '';
      
      q.opcoes.forEach((opcao, index) => {
        const button = document.createElement('button');
        button.className = 'w-full text-left p-4 md:p-6 rounded-2xl border-2 border-gray-300 hover:border-purple-500 hover:bg-purple-50 transition-all duration-300 text-gray-800 font-semibold text-base md:text-lg';
        button.textContent = opcao;
        button.onclick = () => checkAnswer(index);
        optionsContainer.appendChild(button);
      });
      
      document.getElementById('feedback').classList.add('hidden');
    }

    function checkAnswer(selected) {
      if (answered) return;
      answered = true;
      
      const q = quizData.questoes[currentQuestion];
      const buttons = document.querySelectorAll('#options-container button');
      
      buttons.forEach((btn, index) => {
        btn.disabled = true;
        if (index === q.correta) {
          btn.classList.add('border-green-500', 'bg-green-100');
        } else if (index === selected && selected !== q.correta) {
          btn.classList.add('border-red-500', 'bg-red-100');
        }
      });
      
      const feedback = document.getElementById('feedback');
      const isCorrect = selected === q.correta;
      
      if (isCorrect) {
        score += 10;
        document.getElementById('score').textContent = score;
        feedback.className = 'bg-gradient-to-br from-green-500/20 to-emerald-500/20 border border-green-500/30 rounded-3xl p-6 md:p-8';
        document.getElementById('feedback-icon').textContent = '‚úÖ';
        document.getElementById('feedback-title').textContent = 'Muito bem!';
      } else {
        feedback.className = 'bg-gradient-to-br from-red-500/20 to-rose-500/20 border border-red-500/30 rounded-3xl p-6 md:p-8';
        document.getElementById('feedback-icon').textContent = '‚ùå';
        document.getElementById('feedback-title').textContent = 'Quase l√°!';
      }
      
      document.getElementById('feedback-text').textContent = q.justificativa;
      feedback.classList.remove('hidden');
    }

    function nextQuestion() {
      currentQuestion++;
      if (currentQuestion < quizData.questoes.length) {
        loadQuestion();
      } else {
        showResults();
      }
    }

    function showResults() {
      document.getElementById('quiz-screen').classList.add('hidden');
      document.getElementById('result-screen').classList.remove('hidden');
      
      document.getElementById('final-score').textContent = score;
      
      let emoji, message;
      if (score === 100) {
        emoji = 'üèÜ';
        message = 'PERFEITO! Voc√™ √© um expert em ${livroAtual}!';
      } else if (score >= 80) {
        emoji = 'üåü';
        message = 'Excelente! Voc√™ conhece muito bem ${livroAtual}!';
      } else if (score >= 60) {
        emoji = 'üòä';
        message = 'Muito bom! Continue estudando ${livroAtual}!';
      } else if (score >= 40) {
        emoji = 'üìñ';
        message = 'Bom trabalho! Revise ${livroAtual} para melhorar!';
      } else {
        emoji = 'üí™';
        message = 'Continue praticando! ${livroAtual} √© fascinante!';
      }
      
      document.getElementById('result-emoji').textContent = emoji;
      document.getElementById('result-message').textContent = message;
    }

    function restartQuiz() {
      currentQuestion = 0;
      score = 0;
      document.getElementById('score').textContent = '0';
      document.getElementById('result-screen').classList.add('hidden');
      document.getElementById('start-screen').classList.remove('hidden');
    }
  <\/script>

</body>
</html>`;
        }

        function downloadJSON() {
            if (!questoesData) return;

            const dataStr = JSON.stringify(questoesData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `quiz-${livroAtual.toLowerCase().replace(/\s+/g, '-')}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function downloadHTML() {
            if (!questoesData) return;

            const htmlContent = gerarHTMLCompleto();
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `quiz-${livroAtual.toLowerCase().replace(/\s+/g, '-')}.html`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function toggleView() {
            const questoesView = document.getElementById('questoes-preview');
            const htmlView = document.getElementById('html-preview');
            const toggleIcon = document.getElementById('toggle-icon');
            const toggleText = document.getElementById('toggle-text');

            if (questoesView.classList.contains('hidden')) {
                questoesView.classList.remove('hidden');
                htmlView.classList.add('hidden');
                toggleIcon.textContent = 'üëÅÔ∏è';
                toggleText.textContent = 'Ver HTML';
            } else {
                questoesView.classList.add('hidden');
                htmlView.classList.remove('hidden');
                toggleIcon.textContent = 'üìã';
                toggleText.textContent = 'Ver Quest√µes';
                document.getElementById('html-code').textContent = gerarHTMLCompleto();
            }
        }

        function resetForm() {
            if (confirm('üîÑ Deseja gerar um novo quiz? As quest√µes atuais ser√£o perdidas se n√£o forem salvas.')) {
                questoesData = null;
                livroAtual = '';
                document.getElementById('livro-input').value = '';
                document.getElementById('contexto-input').value = '';
                document.getElementById('results').classList.add('hidden');
                document.getElementById('livro-input').focus();
            }
        }
    </script>

</body>

</html>